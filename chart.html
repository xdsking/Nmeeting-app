<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Demo聊天</title>
    <link href="//cdn.bootcss.com/animate.css/3.3.0/animate.css" rel="stylesheet">
    <script src="../CDN/lib/jQuery/jQuery-1.11.1.js"></script>
    <script src="../CDN/lib/bootstrap-3.3.0-dist/dist/js/bootstrap.min.js"></script>
    <script>
        /**
         *  @param domNode <Object> 消息片段
         *  @param animType <String> 动画类型
         *  @param isRemove <boolean> 执行完动画是否移除domNode
         */
        var executeAnim = function (domNode, animType, isRemove) {
            domNode.removeClass().addClass(animType + ' animated').one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend', function () {
                if (isRemove) {
                    $(this).remove();
                }
            });
        };
        /**
         * @summary 发送消息处理函数;
         * @param parentNode 消息父容器;
         * @param newMessage 消息片段;
         */
        var sendMessage = function (parentNode, newMessage) {
            var animInType = "slideInUp",//添加消息时的动画效果;
                    animOutType = "flipOutX",//移除消息时的动画效果;
                    timeOut = 5000,//延迟5秒后移除消息;
                    maxMessageNum = 5;
            parentNode.append(newMessage);//父容器中插入聊天信息;
            executeAnim(newMessage, animInType, false);//添加消息;
            window.setTimeout(function () {
                executeAnim(newMessage, animOutType, true);//移除消息
            }, timeOut);
            var childrenNode = parentNode.children(), childrenNodeLength = childrenNode.length, endIndex = childrenNodeLength - maxMessageNum;
            if (endIndex > 0) {
                for (var i = 0; i < endIndex; i++) {
                    executeAnim($(childrenNode[i]), animOutType, true);
                }
            }
        };

        $(function () {
            var chartPane = $("#chartPane"),//聊天记录容器，相对于其父容器绝对定位;
                    temp = 0;
            $("#sendMessage").click(function () {
                var newMessage = $('<p>xxx:一xxxxxxxxxxxxxxxxxxxxxx条新消息' + temp + '！</p>');
                sendMessage(chartPane, newMessage);
                temp += 20;
            });
        });
    </script>
</head>
<body>


<div style="height: 400px;width: 250px;background-color: powderblue;position: absolute">
    <div id="chartPane" style="position: absolute;bottom: 20px;"></div>
</div>
<div style="margin-left: 260px;">

    <input type="button" value="发送消息" id="sendMessage">
</div>
</body>
</html>